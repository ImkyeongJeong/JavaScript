<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue.js 애완용품샵</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <link rel="stylesheet" text="text/css" href="assets/css/app.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
    integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
<body>
  <script>
    //json 파일 데이터 읽어오고 console에 출력
    /* $.ajax({
        url: 'products.json',
        dataType: 'json',
        success: function (data) {
          console.log(data);
        }
        });
    */
   fetch('./products.json')
   .then(res => {return res.json();})
   .then(data => {
    console.log(data);
   }).catch(err => console.log(err));
  </script>
  <script>
    document.addEventListener("DOMContentLoaded",function(){
      var webstore = new Vue({
        el : '#app',
        data :{
          sitename : 'Vues.js 애완용품샵',
          product : {
            id : 1001,
            title : '고양이 사료, 25파운드',
            description: '당신의 고양이를 위한 <em>거부할 수 없는</em>,'+
                          '유기농 25파운드 사료입니다.',
            price : 2000,
            image : 'assets/images/product-fullsize.png',
            stock : 5,
            rating : 3
          },
          cart : [],
          showProduct : true,
          order : {
            firstName: '',
            lastName: '',
            address : '',
            city : '',
            zip : '',
            state : '',
            method : '자택 주소',
            business : '직장 주소',
            home : '자택 주소',
            gift : '선물로 보내기',
            sendGift : '선물로 보내기',
            dontSendGift : '선물로 보내지 않기',
          },
          states : {
            AL : '알라바마',
            AK : '알래스카',
            AR : '애리조나',
            CA : '캘리포니아',
            NV : '네바다'
          }
        },
        computed : {
          cartItemCount : function(){
            return this.cart.length;
          },
          canAddToCart : function(){
            return this.cartItemCount < this.product.stock;
          }
        },
        methods : {
          addToCart : function(){
            // 객체는 참조타입이라 다른 쪽에서 변경해버리면 변경된 데이터를 참조하기 때문에 객체 자체를 넣지마!
            this.cart.push(this.product.id);
          },
          showCheckout : function(){
            // false면 true, true면 false로 
            this.showProduct = this.showProduct ? false : true;
          },
          submitForm: function(){
            alert('제출완료');
          },
          checkRating : function(n){
            return (this.product.rating - n) >= 0;
          }
        },
        filters : {
          formatPrice : function(price){
            if(!parseInt(price)) {return '';}
            if(price > 99999){
              //$1,000 이상의 값
              var priceString = (price / 100).toFixed(2); //소수변환(2번째 자리)
              var priceArray = priceString.split('').reverse();
              var index = 3;
              while(priceArray.length > index + 3){
                priceArray.splice(index+3, 0, ',');
                index += 4;
              }
              return '$' + priceArray.reverse().join('');
            } else {
              return '$' + (price / 100).toFixed(2);
            }
          }
        }
      });
    });
  </script>  
  <div id="app" class="container">
    <header>
      <div class="navbar navbar-default">
        <div class="navbar-header">
          <h1>{{ sitename }}</h1>
        </div>
        <div class="nav navber-nav navbar-right cart">
          <button type="button" class="btn btn-default btn-lg" v-on:click="showCheckout()">
            <span class="glypicon glypicon-shopping-cart">{{ cartItemCount }}</span>
            <span>체크아웃</span>
          </button>
        </div>
      </div>
    </header>
    <main>
      <div class="row product" v-if="showProduct">
        <div class="col">
          <!-- 상품 이미지 출력 -->
          <figure>
            <img v-bind:src="product.image">
          </figure>
        </div>
        <div class="col col-expand">
          <!-- 상품관련 정보 출력 -->
          <h1 v-text="product.title"></h1>
          <p v-html="product.description"></p>
          <p class="price">{{ product.price | formatPrice }}</p>
        </div>
        <button class="btn btn-primary btn-lg" 
                v-on:click="addToCart" 
                v-show="canAddToCart">장바구니 담기</button>
        <span class="inventory-message" v-if="(product.stock - cartItemCount) == 0">품절!</span>
        <span class="inventory-message" v-else-if="(product.stock - cartItemCount) > 2">{{ product.stock - cartItemCount }} 남았습니다!</span>
        <span class="inventory-message" v-else>지금 구매하세요 !</span>
        <div class="rating">
          <span v-for="n in 5" v-bind:class="{'rating-active' : checkRating(n)}">☆</span>
        </div>
      </div>
      <div class="row" v-else>
        <div class="col-md-10 col-md-offset-1">
          <div class="panel panel-info">
            <div class="panel-heading">애완용품샵 체크아웃</div>
            <div class="panel-body">

              <div class="form-group">
                <div class="col-md-12">
                  <h4><strong>정보를 입력하세요.</strong></h4>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-6">
                  <strong>이름:</strong>
                  <input class="form-control" v-model="order.firstName">
                </div>
                <div class="col-md-6">
                  <strong>성:</strong>
                  <input class="form-control" v-model.trim="order.lastName">
                </div>

              <div class="form-group">
                <div class="col-md-12">
                  <strong>주소:</strong>
                </div>
                <div class="col-md-12">
                  <input class="form-control" v-model.trim="order.address">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-12">
                  <strong>도시</strong>
                </div>
                <div class="col-md-12">
                  <input class="form-control" v-model.trim="order.city">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-2">
                  <strong>주:</strong>
                  <select class="form-control" v-model.trim="order.state" >
                    <option disabled value="">주</option>
                    <!-- 객체 형태로 value, key 꺼내옴 -->
                    <option v-for="(state, key) in states" v-bind:value="state">{{ key }}</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-6 col-md-offset-4">
                  <strong>우편번호:</strong>
                  <input class="form-control" type="number" v-model.number="order.zip">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-6 boxes">
                  <input type="checkbox" id="gift" value="true"
                    v-bind:true-value="order.sendGift" 
                    v-bind:false-value="order.dontSendGift" 
                    v-model="order.gift">
                  <label for="gift">선물로 보내기?</label>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-6 boxes">
                  <input type="radio" id="home" v-bind:value="order.home" v-model="order.method">
                  <label for="home">자택</label>
                  <input type="radio" id="business" v-bind:value="order.business" v-model="order.method">
                  <label for="business">직장</label>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-6"></div>
                <button type="submit" class="btn btn-primary submit" v-on:click="submitForm()">주문하기</button>
              </div>

              <div class="col-md-12 verify">
                <pre>
                  이름 : {{ order.firstName }}
                  성 : {{ order.lastName}}
                  주소 : {{ order.address }}
                  도시 : {{ order.city }}
                  우편번호 : {{ order.zip }}
                  주 : {{ order.state }}
                  배송지 : {{ order.method}}
                  선물 : {{ order.gift }}
                </pre>
              </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>
</html>